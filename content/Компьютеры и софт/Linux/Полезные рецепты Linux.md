# Полезные рецепты



---

Теги:

- [Компьютеры](../../_tags/компьютеры.md)
- [Программное обеспечение](../../_tags/программное%20обеспечение.md)
- [Linux](../../_tags/linux.md)
- [Полезные рецепты](../../_tags/полезные%20рецепты.md)
- [Системное администрирование](../../_tags/системное%20администрирование.md)

---

1. [Конвертация текста из cp866](#Конвертация-текста-из-cp866)
1. [Пинг с метками времени](#Пинг-с-метками-времени)
1. [OOM killer](#OOM-killer)

## Конвертация текста из cp866

При переносе данных между терминалами/процессами/виртуальными машинами можно
иногда получить кракозябры из-за различия кодировок.

Получить вменяемый текст можно вот таким способом:

```shell
echo '╧Ёшёюхфшэхээюх ъ ёшёЄхьх єёЄЁющёЄтю эх ЁрсюЄрхЄ. ' | iconv -f utf8 -t cp866 | iconv -f cp1251 -t utf8
```

```shell
Присоединенное к системе устройство не работает.
```

## Пинг с метками времени

Иногда бывает необходимо видеть метки времени при выполнении ping. Рецепт для
CentOS.

```shell
ping www.google.fr | bash -c 'trap "" INT; awk "{print strftime(\"%Y-%m-%d %H:%M:%S - \") \$0}"'
```

# OOM killer

Если процесс жрёт слишком много памяти, система может убить его. 
Узнать об этом можно тут:
```shell
dmesg | less
```

Попытаться узнать факт убийства:
```shell
#!/bin/bash
<your_job_here>
ret=$?
#
#  returns > 127 are a SIGNAL
#
if [ $ret -gt 127 ]; then
        sig=$((ret - 128))
        echo "Got SIGNAL $sig"
        if [ $sig -eq $(kill -l SIGKILL) ]; then
                echo "process was killed with SIGKILL"
                dmesg > $HOME/dmesg-kill.log
        fi
fi
```
